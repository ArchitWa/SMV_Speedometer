# SMV_STM32_Speedometer

This is the library for the 5641AS. The datasheet for the hardware can be found [here](https://www.xlitx.com/datasheet/5641AS.pdf). Currently, the speedometer is controlled through the code. Given a four digit number, each digit is transformed into 7 segments which are then turned high/low to produce the correct digit on the display.

## Wiring
To testbench the display, use the wiring schematic. You'll notice for the DP pin, it uses PA7, however on the actual UI board, PA6 will be used. For this current iteration of the library, please use PA7 as the DP pin. Make sure that there is a 220 ohm resistor for every connection!

![Wiring Diagram](https://cdn.discordapp.com/attachments/954588709162987530/1467971177384382609/Screenshot_2026-02-02_at_11.53.16_AM.png?ex=69825232&is=698100b2&hm=d882e149034eebb589385afdebe6c15852c6f8e13f346df05f9a0c70c1bf731a)

## Installation
Your IOC file will need to be generated with the correct specifications. The pins in the wiring diagram will need to be set in the IOC file. Specifically, when picking the digit selection pins (named `D1`, `D2`, etc), please rename them to be `Digit_x` in order for the macros to work) [x is the digit number].

This library uses the same clock configurations as the CANbus library, so refer to that. 

Put all .h files under `/Core/Inc`, and put `smv_speedometer.c` under `/Core/Src`. The `main.c` in this repo is just an example and does not need to be included for installation.

## Usage
Include the `smv_speedometer.h` file at the top of your `main.c`.
For any variables in all caps, replace with your own. Remember that the four digit display can only display four digits so keep your numbers smaller than 9999.

Initialize a new Speedometer object with:
```
/* Generated by the IOC */
HAL_Init();
SystemClock_Config();
MX_GPIO_Init();

SMV_Speedometer speedo = SMV_Speedometer_new();
speedo.init(&speedo);
```

To display a number:
```
speedo.setValue(&speedo, YOUR_NUMBER);  
speedo.scan(&speedo);
HAL_Delay(2);       
```

To create a counter-like display:
```
while (1)
{
    speedo.setValue(&speedo, YOUR_NUMBER);  
    speedo.scan(&speedo);               

    YOUR_NUMBER++;
    if (YOUR_NUMBER > 9999) YOUR_NUMBER = 0;

    HAL_Delay(2);
}
```
